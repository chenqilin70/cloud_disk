;function contextMenu(a){this.opt=this.extend(true,this.options,a);this.target=this.opt.target;if(this.opt.classes&&!this.opt.linkClass){this.menuBoxClass=this.extend(true,{"position":"absolute"},this.opt.classes.menuBox);this.menuTitleClass=this.extend(true,{},this.opt.classes.menuTitle.self);this.menuTitleIconClass=this.extend(true,{display:"inline-block"},this.opt.classes.menuTitle.icon);this.menuTitleConClass=this.extend(true,{},this.opt.classes.menuTitle.content);this.itemClass=this.extend(true,{},this.opt.classes.item.self);this.itemIconClass=this.extend(true,{display:"inline-block"},this.opt.classes.item.icon);this.itemConClass=this.extend(true,{},this.opt.classes.item.content);this.hoverClass=this.extend(true,{},this.opt.classes.item.hover);this.separatorClass=this.extend(true,{},this.opt.classes.separator);this.keymapClass=this.extend(true,{"display":"inline-block","height":"100%","line-height":"30px","float":"right"},this.opt.classes.item.keymap)}this.init()}contextMenu.prototype.init=function(){this.menuBox=document.createElement("div");this.attr(this.menuBox,{"unselectable":"on"});this.attr(this.menuBox,{"onselectstart":"return false;"});this.css(this.menuBox,{"-moz-user-select":"none"});this.css(this.menuBox,{"-webkit-user-select":"none"});if(!this.opt.linkClass){this.css(this.menuBox,this.menuBoxClass)}this.addClass(this.menuBox,"kinerMenuBox");if(this.opt.hasTitle){this.menuTitle=document.createElement("h2");this.addClass(this.menuTitle,"kinerMenuTitle");if(this.opt.menu.title.icon&&this.opt.menu.title.icon.trim().length!=0){var c=this.opt.hasIcon?"img":"span";var h=document.createElement(c);this.addClass(h,"kinerMenuTitleIcon");if(!this.opt.linkClass){this.css(h,this.menuTitleIconClass)}if(!this.opt.hasIcon){this.css(h,{width:0})}this.attr(h,{src:this.opt.menu.title.icon});this.menuTitle.appendChild(h)}else{var h=document.createElement("span");this.addClass(h,"kinerMenuTitleIcon");if(!this.opt.linkClass){this.css(h,this.menuTitleIconClass)}if(!this.opt.hasIcon){this.css(h,{width:0})}this.menuTitle.appendChild(h)}var b=document.createElement("span");this.addClass(b,"kinerMenuTitleCon");if(!this.opt.linkClass){this.css(this.menuTitle,this.menuTitleClass);this.css(b,this.menuTitleConClass)}b.innerHTML=this.opt.menu.title.content;this.menuTitle.appendChild(b);this.menuBox.appendChild(this.menuTitle)}var d=0,f=this.opt.menu.items;if(f){for(d=0;d<f.length;d++){var k;if(f[d]==="-"){k=document.createElement("div");this.addClass(k,"kinerSeparator");if(!this.opt.linkClass){this.css(k,this.separatorClass)}}else{k=document.createElement("div");this.addClass(k,"kinerMenuItem");if(f[d].icon&&f[d].icon.trim().length!=0){var c=this.opt.hasIcon?"img":"span";var g=document.createElement(c);this.addClass(g,"kinerMenuItemIcon");if(!this.opt.linkClass){this.css(g,this.itemIconClass)}if(!this.opt.hasIcon){this.css(g,{width:0})}this.attr(g,{src:f[d].icon});k.appendChild(g)}else{var g=document.createElement("span");this.addClass(g,"kinerMenuItemIcon");if(!this.opt.linkClass){this.css(g,this.itemIconClass)}if(!this.opt.hasIcon){this.css(g,{width:0})}k.appendChild(g)}var a=document.createElement("span");this.addClass(a,"kinerMenuItemCon");if(!this.opt.linkClass){this.css(k,this.itemClass);this.css(a,this.itemConClass)}a.innerHTML=f[d].content;if(f[d].keymap){var e=document.createElement("span");this.addClass(e,"kinerKeyMap");e.innerHTML=f[d].keymap;this.css(e,this.keymapClass);k.appendChild(e)}var j=this;(function(m){if(!j.opt.linkClass){j.on(k,"mouseover",function(){j.css(this,j.hoverClass)});j.on(k,"mouseout",function(){j.css(this,j.itemClass)})}j.on(k,"click",function(i){f[m].action.call(j,i,f[m]);j.hide()});if(f[m].keymap){var l=f[m].keymap.split("+");j.on(document,"keydown",function(i){var n=String.fromCharCode(i.keyCode).toLocaleLowerCase();switch(l[0]){case"alt":if(i.altKey){if(n===l[1].toLocaleLowerCase()){f[m].action.call(j,i,f[m])}}break;case"shift":if(i.shiftKey){if(n===l[1].toLocaleLowerCase()){f[m].action.call(j,i,f[m])}}break;case"ctrl":if(i.ctrlKey){if(n===l[1].toLocaleLowerCase()){f[m].action.call(j,i,f[m])}}break}})}})(d);k.appendChild(a)}this.menuBox.appendChild(k)}}(this.opt.target==document)?(this.$("body")[0].appendChild(this.menuBox)):(this.opt.target.appendChild(this.menuBox));this.hide();this.bind()};contextMenu.prototype.show=function(){if(this.opt.beforeShow){this.opt.beforeShow.call(this,this)}this.css(this.menuBox,{"display":"block"});if(arguments.length==1){var a=0,d=0;var c=(this.opt.target==document)?(document.documentElement.clientWidth-arguments[0].clientX):(this.opt.target.offsetWidth-arguments[0].clientX);var b=(this.opt.target==document)?(document.documentElement.clientHeight-arguments[0].clientY):(this.opt.target.offsetHeight-arguments[0].clientY);if(c<this.menuBox.offsetWidth){a=arguments[0].clientX-this.menuBox.offsetWidth}else{a=arguments[0].clientX}if(b<this.menuBox.offsetHeight){d=arguments[0].clientY-this.menuBox.offsetHeight}else{d=arguments[0].clientY}this.css(this.menuBox,{"left":a+"px","top":d+"px"});if(this.opt.afterShow){this.opt.afterShow.call(this,this)}}};contextMenu.prototype.hide=function(){if(this.opt.beforeHide){this.opt.beforeHide.call(this,this)}this.css(this.menuBox,{"display":"none"});if(this.opt.afterHide){this.opt.afterHide.call(this,this)}};contextMenu.prototype.bind=function(){var a=this;a.on(a.target,"contextmenu",function(c){a.show(c);event.returnValue=false});a.on(document,"click",function(){a.hide()});a.on(a.menuBox,"click",function(c){a.sb(c)});if(a.opt.autoHide){var b=null;a.on(a.menuBox,"mouseover",function(c){clearTimeout(b)});a.on(a.menuBox,"mouseout",function(c){b=setTimeout(function(){a.hide()},300)})}};contextMenu.prototype.$=function(b,d){var u=this;if(typeof(b)!=="string"||b==""){return[b]}var k=[];var m=null;var w=b.split(" ");var n="";var v=w[0].split(":")[0];if(v!=w[0]){n=w[0].split(":")[1]}var e=v.split("[")[0];if(e!=v){e=v.split("[")[1].replace(/[",\]]/g,"")}else{e=""}v=v.split("[")[0];d=d||document;switch(v.charAt(0)){case"#":m=document.getElementById(v.substr(1));if(m){k.push(m)}break;case".":var f=d.getElementsByTagName("*");var p=v.substr(1);for(var h=0;h<f.length;h++){if(f[h].className.search("\\b"+p+"\\b")!=-1){k.push(f[h])}}break;default:k=d.getElementsByTagName(v);break}if(e){var f=[];var t=e.split("=");for(var h=0;h<k.length;h++){if(t.length==2&&k[h][t[0]]==t[1]){f.push(k[h])}}k=f}if(n){var f=[];for(var h=0;h<k.length;h++){if(k[h][n]){f.push(k[h])}}k=f}if(w.length>1){var f=[];for(var h=0;h<k.length;h++){var r=u.$.call(u,b.substr(w[0].length+1),k[h]);if(r.tagName){f.push(r)}else{for(var g=0;g<r.length;g++){f.push(r[g])}}}k=f}if(m&&w.length==1){k=m;if(k){k.length=1}}else{var f=[];for(var h=0;h<k.length;h++){k[h].$isAdd=false}for(var h=0;h<k.length;h++){if(!k[h].$isAdd){k[h].$isAdd=true;f.push(k[h])}}k=f}return k};contextMenu.prototype.on=function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}else{b["on"+a]=c}}};contextMenu.prototype.options={target:document,menu:{title:{icon:"imgs/em_1.gif",content:"\u81ea\u5b9a\u4e49\u53f3\u952e\u83dc\u5355"},items:[{icon:"imgs/em_2.gif",content:"\u83dc\u5355\u98791",action:function(a){alert(a.content)}},"-",{icon:"imgs/em_2.gif",content:"\u83dc\u5355\u98792",action:function(a){alert("====>"+a.content)}}]}};contextMenu.prototype.extend=function(b,a,d){if(b){var e={};for(var c in a){e[c]=a[c]}for(var c in d){e[c]=d[c]}return e}else{for(var c in d){a[c]=d[c]}return a}};contextMenu.prototype.css=function(){var b=arguments;var d=0;var a=b.length;if(a==2){var f=b[0],e=b[1];if(this.isArray(f)){for(d=0;d<f.length;d++){if(typeof e==="string"){if(f[d].currentStyle){return this.fixed(f[d].currentStyle[e],1)}else{if(window.getComputedStyle){e=e.replace(/([A-Z])/g,"-$1");e=e.toLowerCase();return this.fixed(document.defaultView.getComputedStyle(f[d],null)[e],1)}}}else{if(typeof e==="object"){for(var c in e){f[d].style[c]=e[c]}}}}}else{if(typeof e==="string"){if(f.currentStyle){return this.fixed(f.currentStyle[e],1)}else{if(window.getComputedStyle){e=e.replace(/([A-Z])/g,"-$1");e=e.toLowerCase();return this.fixed(document.defaultView.getComputedStyle(f,null)[e],1)}}}else{if(typeof e==="object"){for(var c in e){f.style[c]=e[c]}}}}}};contextMenu.prototype.attr=function(){var b=arguments;var d=0;var a=b.length;if(a==2){var f=b[0],e=b[1];if(this.isArray(f)){for(d=0;d<f.length;d++){if(typeof e==="string"){if(e.trim().length!=0){return f[d].getAttribute(e)}else{return f[d].attributes}}else{if(typeof e==="object"){for(var c in e){f[d].setAttribute(c,e[c])}}}}}else{if(typeof e==="string"){if(e.trim().length!=0){return f.getAttribute(e)}else{return f.attributes}}else{if(typeof e==="object"){for(var c in e){f.setAttribute(c,e[c])}}}}}};contextMenu.prototype.isArray=function(a){return toString.call(a)==="[object Array]"};contextMenu.prototype.sb=function(a){if(a&&a.stopPropagation){a.stopPropagation()}else{window.event.cancelBubble=true}};contextMenu.prototype.hasClass=function(b,a){return b.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))};contextMenu.prototype.addClass=function(c,a){if(this.isArray(c)){for(var b=0;b<c.length;b++){if(!this.hasClass(c[b],a)){c[b].className+=" "+a}}}else{if(!this.hasClass(c,a)){c.className+=" "+a}}};contextMenu.prototype.removeClass=function(d,a){if(this.isArray(d)){for(var b=0;b<d.length;b++){if(this.hasClass(d[b],a)){var c=new RegExp("(\\s|^)"+a+"(\\s|$)");d[b].className=d[b].className.replace(c," ")}}}else{if(this.hasClass(d,a)){var c=new RegExp("(\\s|^)"+a+"(\\s|$)");d.className=d.className.replace(c," ")}}};contextMenu.prototype.toggleClass=function(c,a){if(this.isArray(c)){for(var b=0;b<c.length;b++){if(this.hasClass(c[b],a)){this.removeClass(c[b],a)}else{this.addClass(c[b],a)}}}else{if(this.hasClass(c,a)){this.removeClass(c,a)}else{this.addClass(c,a)}}};contextMenu.prototype.isEmptyObject=function(b){for(var a in b){return false}return true};